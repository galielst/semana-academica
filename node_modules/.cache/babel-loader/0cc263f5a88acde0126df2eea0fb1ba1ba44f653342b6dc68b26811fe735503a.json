{"ast":null,"code":"import{useState}from\"react\";import{Scanner}from\"@yudiel/react-qr-scanner\";import{supabase}from\"../../supabaseClient\";import EventRegistrantsPanel from\"./EventRegistrantsPanel\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function CheckInScanner(){const[result,setResult]=useState(null);const[lastError,setLastError]=useState(\"\");const[confirmMsg,setConfirmMsg]=useState(\"\");// Registrar asistencia en Supabase\nasync function registrarAsistencia(payload){setConfirmMsg(\"\");setLastError(\"\");try{const obj=JSON.parse(payload);if(!obj.reg_id||!obj.event_id)throw new Error(\"QR inválido\");const{data:reg,error}=await supabase.from(\"registrations\").select(\"id, user_id, event_id, checked_in_at\").eq(\"id\",obj.reg_id).eq(\"event_id\",obj.event_id).single();if(error||!reg)throw new Error(\"Registro no encontrado\");if(!reg.checked_in_at){await supabase.from(\"registrations\").update({checked_in_at:new Date().toISOString()}).eq(\"id\",reg.id);}await supabase.from(\"attendance\").insert({registration_id:reg.id});setConfirmMsg(\"✔️ Asistencia registrada\");}catch(err){setLastError((err===null||err===void 0?void 0:err.message)||\"Error al registrar asistencia\");}}// ✅ Detecta QR leído\nconst handleDecode=decodedText=>{if(decodedText&&decodedText!==result){setResult(decodedText);registrarAsistencia(decodedText);}};// ✅ Maneja errores del scanner\nconst handleError=err=>{console.error(err);setLastError((err===null||err===void 0?void 0:err.message)||\"Error en el escaneo\");};return/*#__PURE__*/_jsxs(\"div\",{style:{display:\"grid\",gap:12,gridTemplateColumns:\"1fr 1fr\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{borderRadius:16,overflow:\"hidden\",background:\"#000\",aspectRatio:\"16/9\"},children:/*#__PURE__*/_jsx(Scanner,{onDecode:handleDecode// Correcto para QR detectado\n,onError:handleError// Correcto para errores\n,constraints:{facingMode:\"environment\"},style:{width:\"100%\",height:\"100%\"}})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{style:{fontWeight:700,marginBottom:8},children:\"Resultado\"}),result&&/*#__PURE__*/_jsx(\"pre\",{style:{fontSize:12,padding:8,background:\"#f3f4f6\",borderRadius:12,overflowX:\"auto\"},children:result}),confirmMsg&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"#065f46\",fontSize:14,marginTop:8},children:confirmMsg}),lastError&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"#b91c1c\",fontSize:14,marginTop:8},children:lastError}),/*#__PURE__*/_jsx(EventRegistrantsPanel,{})]})]});}","map":{"version":3,"names":["useState","Scanner","supabase","EventRegistrantsPanel","jsx","_jsx","jsxs","_jsxs","CheckInScanner","result","setResult","lastError","setLastError","confirmMsg","setConfirmMsg","registrarAsistencia","payload","obj","JSON","parse","reg_id","event_id","Error","data","reg","error","from","select","eq","single","checked_in_at","update","Date","toISOString","id","insert","registration_id","err","message","handleDecode","decodedText","handleError","console","style","display","gap","gridTemplateColumns","children","borderRadius","overflow","background","aspectRatio","onDecode","onError","constraints","facingMode","width","height","fontWeight","marginBottom","fontSize","padding","overflowX","color","marginTop"],"sources":["C:/Users/Home/Documents/registro-de-eventos/src/components/Admin/CheckInScanner.jsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { Scanner } from \"@yudiel/react-qr-scanner\";\r\nimport { supabase } from \"../../supabaseClient\";\r\nimport EventRegistrantsPanel from \"./EventRegistrantsPanel\";\r\n\r\nexport default function CheckInScanner() {\r\n  const [result, setResult] = useState(null);\r\n  const [lastError, setLastError] = useState(\"\");\r\n  const [confirmMsg, setConfirmMsg] = useState(\"\");\r\n\r\n  // Registrar asistencia en Supabase\r\n  async function registrarAsistencia(payload) {\r\n    setConfirmMsg(\"\");\r\n    setLastError(\"\");\r\n\r\n    try {\r\n      const obj = JSON.parse(payload);\r\n      if (!obj.reg_id || !obj.event_id) throw new Error(\"QR inválido\");\r\n\r\n      const { data: reg, error } = await supabase\r\n        .from(\"registrations\")\r\n        .select(\"id, user_id, event_id, checked_in_at\")\r\n        .eq(\"id\", obj.reg_id)\r\n        .eq(\"event_id\", obj.event_id)\r\n        .single();\r\n\r\n      if (error || !reg) throw new Error(\"Registro no encontrado\");\r\n\r\n      if (!reg.checked_in_at) {\r\n        await supabase\r\n          .from(\"registrations\")\r\n          .update({ checked_in_at: new Date().toISOString() })\r\n          .eq(\"id\", reg.id);\r\n      }\r\n\r\n      await supabase.from(\"attendance\").insert({ registration_id: reg.id });\r\n      setConfirmMsg(\"✔️ Asistencia registrada\");\r\n    } catch (err) {\r\n      setLastError(err?.message || \"Error al registrar asistencia\");\r\n    }\r\n  }\r\n\r\n  // ✅ Detecta QR leído\r\n  const handleDecode = (decodedText) => {\r\n    if (decodedText && decodedText !== result) {\r\n      setResult(decodedText);\r\n      registrarAsistencia(decodedText);\r\n    }\r\n  };\r\n\r\n  // ✅ Maneja errores del scanner\r\n  const handleError = (err) => {\r\n    console.error(err);\r\n    setLastError(err?.message || \"Error en el escaneo\");\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: \"grid\", gap: 12, gridTemplateColumns: \"1fr 1fr\" }}>\r\n      <div\r\n        style={{\r\n          borderRadius: 16,\r\n          overflow: \"hidden\",\r\n          background: \"#000\",\r\n          aspectRatio: \"16/9\",\r\n        }}\r\n      >\r\n        <Scanner\r\n          onDecode={handleDecode}               // Correcto para QR detectado\r\n          onError={handleError}                 // Correcto para errores\r\n          constraints={{ facingMode: \"environment\" }}\r\n          style={{ width: \"100%\", height: \"100%\" }}\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <h4 style={{ fontWeight: 700, marginBottom: 8 }}>Resultado</h4>\r\n        {result && (\r\n          <pre\r\n            style={{\r\n              fontSize: 12,\r\n              padding: 8,\r\n              background: \"#f3f4f6\",\r\n              borderRadius: 12,\r\n              overflowX: \"auto\",\r\n            }}\r\n          >\r\n            {result}\r\n          </pre>\r\n        )}\r\n        {confirmMsg && (\r\n          <p style={{ color: \"#065f46\", fontSize: 14, marginTop: 8 }}>\r\n            {confirmMsg}\r\n          </p>\r\n        )}\r\n        {lastError && (\r\n          <p style={{ color: \"#b91c1c\", fontSize: 14, marginTop: 8 }}>\r\n            {lastError}\r\n          </p>\r\n        )}\r\n        <EventRegistrantsPanel />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}