{"ast":null,"code":"// ./components/Admin/ExportListas.jsx\nimport{useState,useEffect}from\"react\";import{supabase}from\"../../supabaseClient\";import Button from\"../ui/Button\";import Label from\"../ui/Label\";import Select from\"../ui/Select\";import escapeCSV from\"../utils/escapeCSV\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ExportListas(){const[eventId,setEventId]=useState(\"\");const[rows,setRows]=useState([]);const[events,setEvents]=useState([]);// Cargar eventos disponibles\nuseEffect(()=>{(async()=>{const{data}=await supabase.from(\"events\").select(\"id,title\").order(\"starts_at\");setEvents(data||[]);})();},[]);// Cargar inscripciones del evento seleccionado\nuseEffect(()=>{if(eventId)load();else setRows([]);},[eventId]);async function load(){const{data,error}=await supabase.from(\"registrations_admin_view\").select(\"id, title, user_email, full_name, phone, checked_in_at\").eq(\"event_id\",eventId).order(\"full_name\");if(!error)setRows(data||[]);}// Eliminar inscripción\nasync function removeRegistration(id){if(!window.confirm(\"¿Eliminar inscripción de este alumno?\"))return;const{error}=await supabase.from(\"registrations\").delete().eq(\"id\",id);if(!error)load();else alert(\"Error al eliminar: \"+error.message);}function toCSV(){const header=[\"Nombre\",\"Correo\",\"Teléfono\",\"Asistencia\",\"Evento\"];const lines=rows.map(r=>[escapeCSV(r.full_name||\"\"),escapeCSV(r.user_email||\"\"),escapeCSV(r.phone||\"\"),escapeCSV(r.checked_in_at?\"Sí\":\"No\"),escapeCSV(r.title||\"\")].join(\",\"));const csv=[header.join(\",\"),...lines].join(\"\\n\");const blob=new Blob([csv],{type:\"text/csv;charset=utf-8;\"});const url=URL.createObjectURL(blob);const a=document.createElement(\"a\");a.href=url;a.download=\"lista_evento_\".concat(eventId,\".csv\");a.click();URL.revokeObjectURL(url);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{children:\"Selecciona evento\"}),/*#__PURE__*/_jsxs(Select,{value:eventId,onChange:e=>setEventId(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u2014\"}),events.map(e=>/*#__PURE__*/_jsx(\"option\",{value:e.id,children:e.title},e.id))]}),eventId&&rows.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12,maxHeight:300,overflowY:\"auto\",border:\"1px solid #e5e7eb\",borderRadius:12,padding:8},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"Vista previa de alumnos inscritos (\",rows.length,\"):\"]}),/*#__PURE__*/_jsxs(\"table\",{style:{width:\"100%\",fontSize:13,marginTop:8,borderCollapse:\"collapse\"},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{background:\"#f3f4f6\"},children:[/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"left\",padding:6},children:\"Nombre\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"left\",padding:6},children:\"Correo\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"left\",padding:6},children:\"Tel\\xE9fono\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"left\",padding:6},children:\"Check-in\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\",padding:6},children:\"Acci\\xF3n\"}),\" \"]})}),/*#__PURE__*/_jsx(\"tbody\",{children:rows.map(r=>/*#__PURE__*/_jsxs(\"tr\",{style:{borderTop:\"1px solid #e5e7eb\"},children:[/*#__PURE__*/_jsx(\"td\",{style:{padding:6},children:r.full_name||\"—\"}),/*#__PURE__*/_jsx(\"td\",{style:{padding:6},children:r.user_email}),/*#__PURE__*/_jsx(\"td\",{style:{padding:6},children:r.phone||\"—\"}),/*#__PURE__*/_jsx(\"td\",{style:{padding:6},children:r.checked_in_at?new Date(r.checked_in_at).toLocaleString():\"Pendiente\"}),/*#__PURE__*/_jsx(\"td\",{style:{padding:6,textAlign:\"center\"},children:/*#__PURE__*/_jsx(Button,{onClick:()=>removeRegistration(r.id),style:{backgroundColor:\"#ef4444\",color:\"#fff\"},children:\"Eliminar\"})})]},r.id))})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:/*#__PURE__*/_jsx(Button,{onClick:toCSV,disabled:!rows.length,children:\"Descargar CSV\"})})]});}","map":{"version":3,"names":["useState","useEffect","supabase","Button","Label","Select","escapeCSV","jsx","_jsx","jsxs","_jsxs","ExportListas","eventId","setEventId","rows","setRows","events","setEvents","data","from","select","order","load","error","eq","removeRegistration","id","window","confirm","delete","alert","message","toCSV","header","lines","map","r","full_name","user_email","phone","checked_in_at","title","join","csv","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","href","download","concat","click","revokeObjectURL","children","value","onChange","e","target","length","style","marginTop","maxHeight","overflowY","border","borderRadius","padding","width","fontSize","borderCollapse","background","textAlign","borderTop","Date","toLocaleString","onClick","backgroundColor","color","disabled"],"sources":["C:/Users/Home/Documents/registro-de-eventos/src/components/Admin/ExportListas.jsx"],"sourcesContent":["// ./components/Admin/ExportListas.jsx\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"../../supabaseClient\";\r\nimport Button from \"../ui/Button\";\r\nimport Label from \"../ui/Label\";\r\nimport Select from \"../ui/Select\";\r\nimport escapeCSV from \"../utils/escapeCSV\";\r\n\r\nexport default function ExportListas() {\r\n  const [eventId, setEventId] = useState(\"\");\r\n  const [rows, setRows] = useState([]);\r\n  const [events, setEvents] = useState([]);\r\n\r\n  // Cargar eventos disponibles\r\n  useEffect(() => {\r\n    (async () => {\r\n      const { data } = await supabase.from(\"events\").select(\"id,title\").order(\"starts_at\");\r\n      setEvents(data || []);\r\n    })();\r\n  }, []);\r\n\r\n  // Cargar inscripciones del evento seleccionado\r\n  useEffect(() => {\r\n    if (eventId) load();\r\n    else setRows([]);\r\n  }, [eventId]);\r\n\r\n  async function load() {\r\n    const { data, error } = await supabase\r\n      .from(\"registrations_admin_view\")\r\n      .select(\"id, title, user_email, full_name, phone, checked_in_at\")\r\n      .eq(\"event_id\", eventId)\r\n      .order(\"full_name\");\r\n    if (!error) setRows(data || []);\r\n  }\r\n\r\n  // Eliminar inscripción\r\n  async function removeRegistration(id) {\r\n    if (!window.confirm(\"¿Eliminar inscripción de este alumno?\")) return;\r\n    const { error } = await supabase.from(\"registrations\").delete().eq(\"id\", id);\r\n    if (!error) load();\r\n    else alert(\"Error al eliminar: \" + error.message);\r\n  }\r\n\r\n  function toCSV() {\r\n    const header = [\"Nombre\",\"Correo\",\"Teléfono\",\"Asistencia\",\"Evento\"];\r\n    const lines = rows.map(r => [\r\n      escapeCSV(r.full_name || \"\"),\r\n      escapeCSV(r.user_email || \"\"),\r\n      escapeCSV(r.phone || \"\"),\r\n      escapeCSV(r.checked_in_at ? \"Sí\" : \"No\"),\r\n      escapeCSV(r.title || \"\")\r\n    ].join(\",\"));\r\n    const csv = [header.join(\",\"), ...lines].join(\"\\n\");\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = `lista_evento_${eventId}.csv`;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Label>Selecciona evento</Label>\r\n      <Select value={eventId} onChange={(e) => setEventId(e.target.value)}>\r\n        <option value=\"\">—</option>\r\n        {events.map(e => (\r\n          <option key={e.id} value={e.id}>{e.title}</option>\r\n        ))}\r\n      </Select>\r\n\r\n      {eventId && rows.length > 0 && (\r\n        <div style={{marginTop:12, maxHeight:300, overflowY:\"auto\", border:\"1px solid #e5e7eb\", borderRadius:12, padding:8}}>\r\n          <strong>Vista previa de alumnos inscritos ({rows.length}):</strong>\r\n          <table style={{width:\"100%\", fontSize:13, marginTop:8, borderCollapse:\"collapse\"}}>\r\n            <thead>\r\n              <tr style={{background:\"#f3f4f6\"}}>\r\n                <th style={{textAlign:\"left\", padding:6}}>Nombre</th>\r\n                <th style={{textAlign:\"left\", padding:6}}>Correo</th>\r\n                <th style={{textAlign:\"left\", padding:6}}>Teléfono</th>\r\n                <th style={{textAlign:\"left\", padding:6}}>Check-in</th>\r\n                <th style={{textAlign:\"center\", padding:6}}>Acción</th> {/* Nueva columna */}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {rows.map(r => (\r\n                <tr key={r.id} style={{borderTop:\"1px solid #e5e7eb\"}}>\r\n                  <td style={{padding:6}}>{r.full_name || \"—\"}</td>\r\n                  <td style={{padding:6}}>{r.user_email}</td>\r\n                  <td style={{padding:6}}>{r.phone || \"—\"}</td>\r\n                  <td style={{padding:6}}>{r.checked_in_at ? new Date(r.checked_in_at).toLocaleString() : \"Pendiente\"}</td>\r\n                  <td style={{padding:6, textAlign:\"center\"}}>\r\n                    <Button\r\n                      onClick={() => removeRegistration(r.id)}\r\n                      style={{ backgroundColor: \"#ef4444\", color: \"#fff\" }}\r\n                    >\r\n                      Eliminar\r\n                    </Button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      <div style={{marginTop:8}}>\r\n        <Button onClick={toCSV} disabled={!rows.length}>Descargar CSV</Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}