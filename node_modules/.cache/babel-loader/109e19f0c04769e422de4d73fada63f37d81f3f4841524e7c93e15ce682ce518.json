{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Home\\\\Documents\\\\registro-de-eventos\\\\src\\\\components\\\\Admin\\\\CheckInScanner.jsx\",\n  _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { Scanner } from \"@yudiel/react-qr-scanner\";\nimport { supabase } from \"../../supabaseClient\";\nimport EventRegistrantsPanel from \"./EventRegistrantsPanel\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function CheckInScanner() {\n  _s();\n  const [result, setResult] = useState(null);\n  const [lastError, setLastError] = useState(\"\");\n  const [confirmMsg, setConfirmMsg] = useState(\"\");\n\n  // Función para registrar la asistencia en Supabase\n  async function registrarAsistencia(payload) {\n    setConfirmMsg(\"\");\n    setLastError(\"\");\n    try {\n      const obj = JSON.parse(payload);\n      if (!obj.reg_id || !obj.event_id) throw new Error(\"QR inválido\");\n      const {\n        data: reg,\n        error\n      } = await supabase.from(\"registrations\").select(\"id, user_id, event_id, checked_in_at\").eq(\"id\", obj.reg_id).eq(\"event_id\", obj.event_id).single();\n      if (error || !reg) throw new Error(\"Registro no encontrado\");\n      if (!reg.checked_in_at) {\n        await supabase.from(\"registrations\").update({\n          checked_in_at: new Date().toISOString()\n        }).eq(\"id\", reg.id);\n      }\n      await supabase.from(\"attendance\").insert({\n        registration_id: reg.id\n      });\n      setConfirmMsg(\"✔️ Asistencia registrada\");\n    } catch (err) {\n      setLastError((err === null || err === void 0 ? void 0 : err.message) || \"Error al registrar asistencia\");\n    }\n  }\n\n  // ✅ Maneja el QR escaneado\n  const handleDecode = data => {\n    if (data && data !== result) {\n      setResult(data);\n      registrarAsistencia(data);\n    }\n  };\n\n  // ✅ Maneja errores del scanner\n  const handleError = err => {\n    console.error(err);\n    setLastError(err instanceof Error ? err.message : \"Error en el escaneo\");\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: \"grid\",\n      gap: 12,\n      gridTemplateColumns: \"1fr 1fr\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        borderRadius: 16,\n        overflow: \"hidden\",\n        background: \"#000\",\n        aspectRatio: \"16/9\"\n      },\n      children: /*#__PURE__*/_jsxDEV(Scanner, {\n        onDecode: handleDecode,\n        onError: handleError,\n        constraints: {\n          facingMode: \"environment\"\n        },\n        style: {\n          width: \"100%\",\n          height: \"100%\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        style: {\n          fontWeight: 700,\n          marginBottom: 8\n        },\n        children: \"Resultado\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), result && /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          fontSize: 12,\n          padding: 8,\n          background: \"#f3f4f6\",\n          borderRadius: 12,\n          overflowX: \"auto\"\n        },\n        children: result\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 11\n      }, this), confirmMsg && /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: \"#065f46\",\n          fontSize: 14,\n          marginTop: 8\n        },\n        children: confirmMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this), lastError && /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: \"#b91c1c\",\n          fontSize: 14,\n          marginTop: 8\n        },\n        children: lastError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(EventRegistrantsPanel, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 5\n  }, this);\n}\n_s(CheckInScanner, \"9qQ8Bc0nvaUrBN+HP81f+f+PoWA=\");\n_c = CheckInScanner;\nvar _c;\n$RefreshReg$(_c, \"CheckInScanner\");","map":{"version":3,"names":["useState","Scanner","supabase","EventRegistrantsPanel","jsxDEV","_jsxDEV","CheckInScanner","_s","result","setResult","lastError","setLastError","confirmMsg","setConfirmMsg","registrarAsistencia","payload","obj","JSON","parse","reg_id","event_id","Error","data","reg","error","from","select","eq","single","checked_in_at","update","Date","toISOString","id","insert","registration_id","err","message","handleDecode","handleError","console","style","display","gap","gridTemplateColumns","children","borderRadius","overflow","background","aspectRatio","onDecode","onError","constraints","facingMode","width","height","fileName","_jsxFileName","lineNumber","columnNumber","fontWeight","marginBottom","fontSize","padding","overflowX","color","marginTop","_c","$RefreshReg$"],"sources":["C:/Users/Home/Documents/registro-de-eventos/src/components/Admin/CheckInScanner.jsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { Scanner } from \"@yudiel/react-qr-scanner\";\r\nimport { supabase } from \"../../supabaseClient\";\r\nimport EventRegistrantsPanel from \"./EventRegistrantsPanel\";\r\n\r\nexport default function CheckInScanner() {\r\n  const [result, setResult] = useState(null);\r\n  const [lastError, setLastError] = useState(\"\");\r\n  const [confirmMsg, setConfirmMsg] = useState(\"\");\r\n\r\n  // Función para registrar la asistencia en Supabase\r\n  async function registrarAsistencia(payload) {\r\n    setConfirmMsg(\"\");\r\n    setLastError(\"\");\r\n\r\n    try {\r\n      const obj = JSON.parse(payload);\r\n      if (!obj.reg_id || !obj.event_id) throw new Error(\"QR inválido\");\r\n\r\n      const { data: reg, error } = await supabase\r\n        .from(\"registrations\")\r\n        .select(\"id, user_id, event_id, checked_in_at\")\r\n        .eq(\"id\", obj.reg_id)\r\n        .eq(\"event_id\", obj.event_id)\r\n        .single();\r\n\r\n      if (error || !reg) throw new Error(\"Registro no encontrado\");\r\n\r\n      if (!reg.checked_in_at) {\r\n        await supabase\r\n          .from(\"registrations\")\r\n          .update({ checked_in_at: new Date().toISOString() })\r\n          .eq(\"id\", reg.id);\r\n      }\r\n\r\n      await supabase.from(\"attendance\").insert({ registration_id: reg.id });\r\n      setConfirmMsg(\"✔️ Asistencia registrada\");\r\n    } catch (err) {\r\n      setLastError(err?.message || \"Error al registrar asistencia\");\r\n    }\r\n  }\r\n\r\n  // ✅ Maneja el QR escaneado\r\n  const handleDecode = (data: string | null) => {\r\n    if (data && data !== result) {\r\n      setResult(data);\r\n      registrarAsistencia(data);\r\n    }\r\n  };\r\n\r\n  // ✅ Maneja errores del scanner\r\n  const handleError = (err: unknown) => {\r\n    console.error(err);\r\n    setLastError(err instanceof Error ? err.message : \"Error en el escaneo\");\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: \"grid\", gap: 12, gridTemplateColumns: \"1fr 1fr\" }}>\r\n      <div\r\n        style={{\r\n          borderRadius: 16,\r\n          overflow: \"hidden\",\r\n          background: \"#000\",\r\n          aspectRatio: \"16/9\",\r\n        }}\r\n      >\r\n        <Scanner\r\n          onDecode={handleDecode}           \r\n          onError={handleError}             \r\n          constraints={{ facingMode: \"environment\" }} \r\n          style={{ width: \"100%\", height: \"100%\" }}\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <h4 style={{ fontWeight: 700, marginBottom: 8 }}>Resultado</h4>\r\n        {result && (\r\n          <pre\r\n            style={{\r\n              fontSize: 12,\r\n              padding: 8,\r\n              background: \"#f3f4f6\",\r\n              borderRadius: 12,\r\n              overflowX: \"auto\",\r\n            }}\r\n          >\r\n            {result}\r\n          </pre>\r\n        )}\r\n        {confirmMsg && (\r\n          <p style={{ color: \"#065f46\", fontSize: 14, marginTop: 8 }}>\r\n            {confirmMsg}\r\n          </p>\r\n        )}\r\n        {lastError && (\r\n          <p style={{ color: \"#b91c1c\", fontSize: 14, marginTop: 8 }}>\r\n            {lastError}\r\n          </p>\r\n        )}\r\n        <EventRegistrantsPanel />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}