{"ast":null,"code":"import{useEffect,useState,useRef}from\"react\";import dayjs from\"dayjs\";import{supabase}from\"../../supabaseClient\";import EventForm from\"./EventForm\";import EventActions from\"./EventActions\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function AdminEventos(_ref){let{filterFull=false}=_ref;const[events,setEvents]=useState([]);const[loading,setLoading]=useState(true);const[editingEvent,setEditingEvent]=useState(null);const formRef=useRef(null);useEffect(()=>{fetchData();},[]);// üîπ fetchData con ordenamiento\nasync function fetchData(){setLoading(true);const{data}=await supabase.rpc(\"events_with_counts\");setLoading(false);// Ordenamos primero por fecha/hora de inicio y luego por t√≠tulo\nlet sortedData=(data||[]).sort((a,b)=>{const startA=new Date(a.starts_at);const startB=new Date(b.starts_at);if(startA<startB)return-1;if(startA>startB)return 1;const titleA=a.title.toLowerCase();const titleB=b.title.toLowerCase();if(titleA<titleB)return-1;if(titleA>titleB)return 1;return 0;});// üîπ Si filterFull es true, mostramos solo eventos llenos\nif(filterFull){sortedData=sortedData.filter(e=>e.registered_count>=e.capacity);}setEvents(sortedData);}const handleEdit=event=>{setEditingEvent(event);if(formRef.current){formRef.current.scrollIntoView({behavior:\"smooth\",block:\"start\"});}};function formatEndTime(ends_at){if(!ends_at)return\"\";if(/^\\d{2}:\\d{2}/.test(ends_at)){return ends_at.slice(0,5);}return dayjs(ends_at).format(\"HH:mm\");}return/*#__PURE__*/_jsxs(\"div\",{style:{display:\"grid\",gap:20},children:[/*#__PURE__*/_jsx(\"div\",{ref:formRef,children:/*#__PURE__*/_jsx(EventForm,{eventToEdit:editingEvent,onCreated:()=>{fetchData();setEditingEvent(null);},onCancel:()=>setEditingEvent(null)})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{style:{fontWeight:700,marginBottom:8},children:filterFull?\"Eventos llenos\":\"Eventos creados\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"}):/*#__PURE__*/_jsxs(\"div\",{style:{display:\"grid\",gridTemplateColumns:\"1fr 1fr\",gap:12},children:[events.map(e=>/*#__PURE__*/_jsx(\"div\",{style:{border:\"1px solid #e5e7eb\",borderRadius:16,padding:12},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{style:{fontWeight:700},children:[e.title,\" \",/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:12,color:\"#6b7280\"},children:[\"(\",e.type,\")\"]})]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:12,color:\"#6b7280\"},children:[dayjs(e.starts_at).format(\"DD/MM/YYYY HH:mm\"),e.ends_at&&/*#__PURE__*/_jsxs(_Fragment,{children:[\" - \",formatEndTime(e.ends_at)]})]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:12},children:[\"Cupo: \",e.registered_count,\"/\",e.capacity]})]}),/*#__PURE__*/_jsx(EventActions,{eventId:e.id,onChanged:fetchData,onEdit:()=>handleEdit(e)})]})},e.id)),events.length===0&&/*#__PURE__*/_jsx(\"p\",{style:{gridColumn:\"1 / -1\",color:\"#6b7280\"},children:filterFull?\"No hay eventos llenos.\":\"No hay eventos creados a√∫n.\"})]})]})]});}","map":{"version":3,"names":["useEffect","useState","useRef","dayjs","supabase","EventForm","EventActions","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AdminEventos","_ref","filterFull","events","setEvents","loading","setLoading","editingEvent","setEditingEvent","formRef","fetchData","data","rpc","sortedData","sort","a","b","startA","Date","starts_at","startB","titleA","title","toLowerCase","titleB","filter","e","registered_count","capacity","handleEdit","event","current","scrollIntoView","behavior","block","formatEndTime","ends_at","test","slice","format","style","display","gap","children","ref","eventToEdit","onCreated","onCancel","fontWeight","marginBottom","gridTemplateColumns","map","border","borderRadius","padding","justifyContent","alignItems","fontSize","color","type","eventId","id","onChanged","onEdit","length","gridColumn"],"sources":["C:/Users/Home/Documents/registro-de-eventos/src/components/Admin/AdminEventos.jsx"],"sourcesContent":["import { useEffect, useState, useRef } from \"react\";\r\nimport dayjs from \"dayjs\";\r\nimport { supabase } from \"../../supabaseClient\";\r\nimport EventForm from \"./EventForm\";\r\nimport EventActions from \"./EventActions\";\r\n\r\nexport default function AdminEventos({ filterFull = false }) {\r\n  const [events, setEvents] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [editingEvent, setEditingEvent] = useState(null);\r\n  const formRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  // üîπ fetchData con ordenamiento\r\n  async function fetchData() {\r\n    setLoading(true);\r\n    const { data } = await supabase.rpc(\"events_with_counts\");\r\n    setLoading(false);\r\n\r\n    // Ordenamos primero por fecha/hora de inicio y luego por t√≠tulo\r\n    let sortedData = (data || []).sort((a, b) => {\r\n      const startA = new Date(a.starts_at);\r\n      const startB = new Date(b.starts_at);\r\n\r\n      if (startA < startB) return -1;\r\n      if (startA > startB) return 1;\r\n\r\n      const titleA = a.title.toLowerCase();\r\n      const titleB = b.title.toLowerCase();\r\n      if (titleA < titleB) return -1;\r\n      if (titleA > titleB) return 1;\r\n      return 0;\r\n    });\r\n\r\n    // üîπ Si filterFull es true, mostramos solo eventos llenos\r\n    if (filterFull) {\r\n      sortedData = sortedData.filter(e => e.registered_count >= e.capacity);\r\n    }\r\n\r\n    setEvents(sortedData);\r\n  }\r\n\r\n  const handleEdit = (event) => {\r\n    setEditingEvent(event);\r\n    if (formRef.current) {\r\n      formRef.current.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\r\n    }\r\n  };\r\n\r\n  function formatEndTime(ends_at) {\r\n    if (!ends_at) return \"\";\r\n    if (/^\\d{2}:\\d{2}/.test(ends_at)) {\r\n      return ends_at.slice(0, 5);\r\n    }\r\n    return dayjs(ends_at).format(\"HH:mm\");\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: \"grid\", gap: 20 }}>\r\n      {/* Formulario arriba */}\r\n      <div ref={formRef}>\r\n        <EventForm\r\n          eventToEdit={editingEvent}\r\n          onCreated={() => {\r\n            fetchData();\r\n            setEditingEvent(null);\r\n          }}\r\n          onCancel={() => setEditingEvent(null)}\r\n        />\r\n      </div>\r\n\r\n      {/* Eventos abajo en 2 columnas */}\r\n      <div>\r\n        <h4 style={{ fontWeight: 700, marginBottom: 8 }}>\r\n          {filterFull ? \"Eventos llenos\" : \"Eventos creados\"}\r\n        </h4>\r\n        {loading ? (\r\n          <p>Cargando...</p>\r\n        ) : (\r\n          <div\r\n            style={{\r\n              display: \"grid\",\r\n              gridTemplateColumns: \"1fr 1fr\",\r\n              gap: 12,\r\n            }}\r\n          >\r\n            {events.map((e) => (\r\n              <div\r\n                key={e.id}\r\n                style={{\r\n                  border: \"1px solid #e5e7eb\",\r\n                  borderRadius: 16,\r\n                  padding: 12,\r\n                }}\r\n              >\r\n                <div\r\n                  style={{\r\n                    display: \"flex\",\r\n                    justifyContent: \"space-between\",\r\n                    alignItems: \"center\",\r\n                  }}\r\n                >\r\n                  <div>\r\n                    <p style={{ fontWeight: 700 }}>\r\n                      {e.title}{\" \"}\r\n                      <span style={{ fontSize: 12, color: \"#6b7280\" }}>\r\n                        ({e.type})\r\n                      </span>\r\n                    </p>\r\n                    <p style={{ fontSize: 12, color: \"#6b7280\" }}>\r\n                      {dayjs(e.starts_at).format(\"DD/MM/YYYY HH:mm\")}\r\n                      {e.ends_at && <> - {formatEndTime(e.ends_at)}</>}\r\n                    </p>\r\n                    <p style={{ fontSize: 12 }}>\r\n                      Cupo: {e.registered_count}/{e.capacity}\r\n                    </p>\r\n                  </div>\r\n                  <EventActions\r\n                    eventId={e.id}\r\n                    onChanged={fetchData}\r\n                    onEdit={() => handleEdit(e)}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n            {events.length === 0 && (\r\n              <p style={{ gridColumn: \"1 / -1\", color: \"#6b7280\" }}>\r\n                {filterFull ? \"No hay eventos llenos.\" : \"No hay eventos creados a√∫n.\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}